<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Spark - ä½“æ„Ÿå‹ãƒ»è‹±å˜èªå­¦ç¿’</title>
    <style>
        /* CSSéƒ¨åˆ†ã¯å¤‰æ›´ã‚ã‚Šã¾ã›ã‚“ */
        :root {
            --bg-color: #121212;
            --card-bg-color: #1e1e1e;
            --primary-text-color: #e0e0e0;
            --secondary-text-color: #b0b0b0;
            --accent-color: #03dac6;
            --accent-hover-color: #018786;
            --hook-color: #bb86fc;
            --correct-color: #4caf50;
            --review-color: #f44336;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Hiragino Sans', 'Noto Sans JP', sans-serif;
            background-color: var(--bg-color);
            color: var(--primary-text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        #app-container {
            width: 100%;
            max-width: 500px;
            text-align: center;
        }
        h1 {
            color: var(--accent-color);
            margin-bottom: 5px;
            font-size: 2.5rem;
        }
        #app-subtitle {
            color: var(--secondary-text-color);
            margin-top: 0;
            margin-bottom: 20px;
        }
        #mode-selector {
            margin-bottom: 20px;
        }
        .mode-btn {
            background-color: transparent;
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
            padding: 10px 15px;
            margin: 0 5px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
        }
        .mode-btn:hover {
            background-color: var(--accent-hover-color);
            color: var(--bg-color);
        }
        .mode-btn.active {
            background-color: var(--accent-color);
            color: var(--bg-color);
            font-weight: bold;
        }
        .card-scene {
            width: 100%;
            height: 300px;
            perspective: 1000px;
            margin-bottom: 20px;
        }
        .card {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
        }
        .card.is-flipped {
            transform: rotateY(180deg);
        }
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            background-color: var(--card-bg-color);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
        }
        .card-face-back {
            transform: rotateY(180deg);
        }
        #word-display {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 0;
        }
        #ipa-display {
            font-size: 1.2rem;
            color: var(--secondary-text-color);
            margin-top: 5px;
        }
        #audio-btn, #audio-btn-back {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 2rem;
            color: var(--accent-color);
            transition: color 0.3s;
        }
        #audio-btn:hover, #audio-btn-back:hover {
            color: var(--accent-hover-color);
        }
        #back-face-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        #japanese-display {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 0;
        }
        #hook-display {
            font-size: 1rem;
            color: var(--hook-color);
            margin-top: 15px;
            font-style: italic;
        }
        .example-display {
            margin-top: 15px;
            font-size: 0.9rem;
            color: var(--secondary-text-color);
        }
        #controls {
            display: flex;
            justify-content: space-between;
            gap: 15px;
        }
        .control-btn {
            flex: 1;
            padding: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: opacity 0.3s;
        }
        .control-btn:hover {
            opacity: 0.8;
        }
        #review-btn {
            background-color: var(--review-color);
            color: white;
        }
        #correct-btn {
            background-color: var(--correct-color);
            color: white;
        }
        #progress-display {
            margin-top: 20px;
            color: var(--secondary-text-color);
        }
        #completion-screen {
            display: none;
        }
    </style>
</head>
<body>

    <div id="app-container">
        <h1>Word Spark</h1>
        <p id="app-subtitle">ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ„å‘³ã‚’ç¢ºèª</p>

        <div id="mode-selector">
            <button id="en-jp-btn" class="mode-btn active">è‹±èª â†’ æ—¥æœ¬èª</button>
            <button id="jp-en-btn" class="mode-btn">æ—¥æœ¬èª â†’ è‹±èª</button>
        </div>

        <div id="main-content">
            <div class="card-scene">
                <div id="card" class="card">
                    <div class="card-face card-face-front">
                        <p id="word-display"></p>
                        <p id="ipa-display"></p>
                        <button id="audio-btn">ğŸ”Š</button>
                    </div>
                    <div class="card-face card-face-back">
                        <div id="back-face-header">
                            <p id="japanese-display"></p>
                            <button id="audio-btn-back">ğŸ”Š</button>
                        </div>
                        <p id="hook-display"></p>
                        <div class="example-display">
                            <p id="example-en-display"></p>
                            <p id="example-ja-display"></p>
                        </div>
                    </div>
                </div>
            </div>
    
            <div id="controls">
                <button id="review-btn" class="control-btn">ã‚‚ã†ä¸€åº¦</button>
                <button id="correct-btn" class="control-btn">è¦šãˆãŸï¼</button>
            </div>
    
            <p id="progress-display"></p>
        </div>

        <div id="completion-screen">
            <h2>ğŸ‰ å…¨ã¦å­¦ç¿’ã—ã¾ã—ãŸï¼</h2>
            <p>ç´ æ™´ã‚‰ã—ã„ã§ã™ï¼æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã™ã‚‹ã«ã¯ã€ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p>
        </div>
    </div>


    <script>
    // ===================================================================================
    // â˜…â˜…â˜… å˜èªãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ ãƒ»ç·¨é›†ã¯ã“ã“ã‹ã‚‰ â˜…â˜…â˜…
    // ===================================================================================
    const wordData = [
        {
            english: "anxious",
            ipa: "/ËˆÃ¦Å‹kÊƒÉ™s/",
            japanese: "å¿ƒé…ã—ã¦ã€åˆ‡æœ›ã—ã¦",
            hook: "ã€Œã‚¢ãƒ³ã‚¯ã—ã¦ã‚·ãƒ£ãƒ„ã‚’æ´ã‚€ã€ã»ã©å¿ƒé…ã—ã¦ã„ã‚‹æ§˜å­ã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ã€‚",
            example_en: "He was anxious about the results of the exam.",
            example_ja: "å½¼ã¯è©¦é¨“ã®çµæœã‚’å¿ƒé…ã—ã¦ã„ãŸã€‚"
        },
        {
            english: "hypotheses",
            ipa: "/haÉªËˆpÉ’Î¸É™siËz/",
            japanese: "ä»®èª¬ï¼ˆè¤‡æ•°å½¢ï¼‰",
            hook: "hypothesisã®è¤‡æ•°å½¢ã€‚ãƒ’ãƒ¼ãƒ­ãƒ¼ãŒã€Œãƒã‚¤ã€ã“ã‚Œä»®èª¬ã§ã™ï¼ã€ã¨è¤‡æ•°æç¤ºã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã€‚",
            example_en: "The scientists tested several hypotheses.",
            example_ja: "ç§‘å­¦è€…ãŸã¡ã¯ã„ãã¤ã‹ã®ä»®èª¬ã‚’æ¤œè¨¼ã—ãŸã€‚"
        },
        {
            english: "industry",
            ipa: "/ËˆÉªndÉ™stri/",
            japanese: "ç”£æ¥­ã€å‹¤å‹‰",
            hook: "ã€Œã‚¤ãƒ³ãƒ‰ã®ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã€ã¯å‹¤å‹‰ãªäººã€…ãŒç”£æ¥­ã‚’æ”¯ãˆã‚‹ç‰©èªã€‚",
            example_en: "The tourism industry is vital for the economy.",
            example_ja: "è¦³å…‰ç”£æ¥­ã¯çµŒæ¸ˆã«ã¨ã£ã¦ä¸å¯æ¬ ã ã€‚"
        },
        {
            english: "fluency",
            ipa: "/ËˆfluËÉ™nsi/",
            japanese: "æµæš¢ã•",
            hook: "æ°´ãŒã€Œæµï¼ˆãƒ•ãƒ«ï¼‰ã‚Œã‚‹ã€ã‚ˆã†ãªæ»‘ã‚‰ã‹ã•ã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ã€‚",
            example_en: "Her fluency in French is impressive.",
            example_ja: "å½¼å¥³ã®ãƒ•ãƒ©ãƒ³ã‚¹èªã®æµæš¢ã•ã¯ç´ æ™´ã‚‰ã—ã„ã€‚"
        },
        {
            english: "idiomatic",
            ipa: "/ËŒÉªdiÉ™ËˆmÃ¦tÉªk/",
            japanese: "æ…£ç”¨çš„ãªã€ç†Ÿèªçš„ãª",
            hook: "ã€Œãƒã‚«ãªï¼ˆidiotï¼‰ãƒãƒ†ã‚£ãƒƒã‚¯ï¼ˆmaticï¼‰ã€ã¨è¦šãˆã‚‹ã¨ã€Œãªã‚“ã§ãã‚“ãªæ„å‘³ã«ï¼Ÿã€ã¨ãªã‚‹æ…£ç”¨å¥ã‚’é€£æƒ³ã—ã‚„ã™ã„ã€‚",
            example_en: "'Spill the beans' is an idiomatic expression.",
            example_ja: "ã€Œè±†ã‚’ã“ã¼ã™ï¼ˆç§˜å¯†ã‚’æ¼ã‚‰ã™ï¼‰ã€ã¯æ…£ç”¨å¥çš„ãªè¡¨ç¾ã ã€‚"
        },
        {
            english: "acquisition",
            ipa: "/ËŒÃ¦kwÉªËˆzÉªÊƒn/",
            japanese: "ç¿’å¾—ã€ç²å¾—",
            hook: "ã€Œã‚¢ã‚¯ï¼ˆacqï¼‰ã‚·ãƒ§ãƒ³ï¼ˆisitionï¼‰ã€ã‚’èµ·ã“ã—ã¦çŸ¥è­˜ã‚’ç²å¾—ã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã€‚",
            example_en: "Language acquisition starts at a young age.",
            example_ja: "è¨€èªã®ç¿’å¾—ã¯å¹¼ã„é ƒã«å§‹ã¾ã‚‹ã€‚"
        },
        {
            english: "comprehension",
            ipa: "/ËŒkÉ’mprÉªËˆhenÊƒn/",
            japanese: "ç†è§£ã€èª­è§£åŠ›",
            hook: "ã€Œã“ã‚Œï¼ˆcomï¼‰ã§ãƒ—ãƒªï¼ˆpreï¼‰ã‚­ãƒ¥ã‚¢ã®å¤‰èº«ï¼ˆhenshionï¼‰ãŒç†è§£ã§ããŸï¼ã€",
            example_en: "Reading comprehension is a key skill.",
            example_ja: "èª­è§£åŠ›ã¯é‡è¦ãªã‚¹ã‚­ãƒ«ã ã€‚"
        },
        {
            english: "determine",
            ipa: "/dÉªËˆtÉœËrmÉªn/",
            japanese: "æ±ºå®šã™ã‚‹ã€ç‰¹å®šã™ã‚‹",
            hook: "å¼·ã„ã€Œãƒ‡ãƒ¼ã‚¿ãƒ¼ï¼ˆdeterï¼‰ã§æ˜ã‚‹ãƒã‚¤ãƒ³ï¼ˆmineï¼‰ã‚¯ãƒ©ãƒ•ãƒˆã€ã®ã‚ˆã†ã«ã€å›ºã„æ±ºæ„ã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ã€‚",
            example_en: "We must determine the cause of the problem.",
            example_ja: "æˆ‘ã€…ã¯ãã®å•é¡Œã®åŸå› ã‚’ç‰¹å®šã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚"
        },
        {
            english: "concrete",
            ipa: "/ËˆkÉ’Å‹kriËt/",
            japanese: "å…·ä½“çš„ãªã€ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆ",
            hook: "ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆã®ã‚ˆã†ã«å›ºãã¦ã€Œå…·ä½“çš„ãªã€è¨ˆç”»ã€‚",
            example_en: "We need a concrete plan, not just ideas.",
            example_ja: "å˜ãªã‚‹ã‚¢ã‚¤ãƒ‡ã‚¢ã§ã¯ãªãã€å…·ä½“çš„ãªè¨ˆç”»ãŒå¿…è¦ã§ã™ã€‚"
        },
        {
            english: "essential",
            ipa: "/ÉªËˆsenÊƒl/",
            japanese: "ä¸å¯æ¬ ãªã€æœ¬è³ªçš„ãª",
            hook: "ã€Œã‚¨ãƒƒã‚»ãƒ³ã‚¹ï¼ˆessencï¼‰ã®ã‚·ãƒ£ãƒ«ï¼ˆtialï¼‰ãƒ‰ãƒã€ã¯ãƒ¯ã‚¤ãƒ³ã®æœ¬è³ªã ã€‚",
            example_en: "Water is essential for life.",
            example_ja: "æ°´ã¯ç”Ÿå‘½ã«ã¨ã£ã¦ä¸å¯æ¬ ã ã€‚"
        }
    ];
    // ===================================================================================
    // â˜…â˜…â˜… å˜èªãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ ãƒ»ç·¨é›†ã¯ã“ã“ã¾ã§ â˜…â˜…â˜…
    // ===================================================================================

    const card = document.getElementById('card');
    const wordDisplay = document.getElementById('word-display');
    const ipaDisplay = document.getElementById('ipa-display');
    const audioBtn = document.getElementById('audio-btn');
    const japaneseDisplay = document.getElementById('japanese-display');
    const hookDisplay = document.getElementById('hook-display');
    const exampleEnDisplay = document.getElementById('example-en-display');
    const exampleJaDisplay = document.getElementById('example-ja-display');
    const reviewBtn = document.getElementById('review-btn');
    const correctBtn = document.getElementById('correct-btn');
    const progressDisplay = document.getElementById('progress-display');
    const enJpBtn = document.getElementById('en-jp-btn');
    const jpEnBtn = document.getElementById('jp-en-btn');
    const mainContent = document.getElementById('main-content');
    const completionScreen = document.getElementById('completion-screen');

    // â˜…â˜…â˜… æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ 1/2 â˜…â˜…â˜…
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    const audioBtnBack = document.getElementById('audio-btn-back');

    let currentWordIndex = 0;
    let deck = [];
    let reviewPile = [];
    let mode = 'en-jp';
    const synth = window.speechSynthesis;

    card.addEventListener('click', () => card.classList.toggle('is-flipped'));
    audioBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        speak(deck[currentWordIndex].english);
    });
    audioBtnBack.addEventListener('click', (e) => {
        e.stopPropagation();
        speak(deck[currentWordIndex].english);
    });
    reviewBtn.addEventListener('click', () => handleAnswer(false));
    correctBtn.addEventListener('click', () => handleAnswer(true));
    enJpBtn.addEventListener('click', () => setMode('en-jp'));
    jpEnBtn.addEventListener('click', () => setMode('jp-en'));

    function setMode(newMode) {
        mode = newMode;
        enJpBtn.classList.toggle('active', mode === 'en-jp');
        jpEnBtn.classList.toggle('active', mode !== 'en-jp');
        startSession();
    }

    function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function startSession() {
        deck = shuffle([...wordData]);
        currentWordIndex = 0;
        reviewPile = [];
        mainContent.style.display = 'block';
        completionScreen.style.display = 'none';
        displayWord();
    }
    
    function displayWord() {
        if (currentWordIndex >= deck.length) {
            if (reviewPile.length > 0) {
                deck = shuffle([...reviewPile]);
                reviewPile = [];
                currentWordIndex = 0;
            } else {
                showCompletionScreen();
                return;
            }
        }
        card.classList.remove('is-flipped');
        const word = deck[currentWordIndex];
        if (mode === 'en-jp') {
            wordDisplay.textContent = word.english;
            wordDisplay.style.fontSize = "2.5rem";
            ipaDisplay.textContent = word.ipa;
            audioBtn.style.display = 'block';
            audioBtnBack.style.display = 'none';
            japaneseDisplay.textContent = word.japanese;
            japaneseDisplay.style.fontSize = "1.8rem";
            hookDisplay.textContent = word.hook;
        } else {
            wordDisplay.textContent = word.japanese;
            wordDisplay.style.fontSize = "1.8rem";
            ipaDisplay.textContent = "";
            audioBtn.style.display = 'none';
            audioBtnBack.style.display = 'block';
            japaneseDisplay.textContent = word.english;
            japaneseDisplay.style.fontSize = "2.5rem";
            hookDisplay.textContent = `ç™ºéŸ³: ${word.ipa}`;
        }
        exampleEnDisplay.textContent = `e.g. ${word.example_en}`;
        exampleJaDisplay.textContent = `ä¾‹ï¼‰${word.example_ja}`;
        updateProgress();
    }
    
    // â˜…â˜…â˜… æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ 2/2 â˜…â˜…â˜…
    function handleAnswer(isCorrect) {
        if (!isCorrect) {
            reviewPile.push(deck[currentWordIndex]);
        }
        
        // åŠ¹æœéŸ³ã‚’å†ç”Ÿï¼ˆæ–‡å­—åˆ—ã®åŸ‹ã‚è¾¼ã¿ã‚’ã‚„ã‚ã€éŸ³ã‚’ç›´æ¥ç”Ÿæˆã™ã‚‹æ–¹æ³•ã«å¤‰æ›´ï¼‰
        if (audioCtx) { // AudioContextãŒåˆ©ç”¨å¯èƒ½ãªå ´åˆã®ã¿å†ç”Ÿ
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            if (isCorrect) {
                // æ­£è§£ã®éŸ³ï¼ˆé«˜ã‚ã®ãƒ”ã‚³ãƒ³ã¨ã„ã†éŸ³ï¼‰
                oscillator.type = 'triangle';
                oscillator.frequency.setValueAtTime(880, audioCtx.currentTime);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + 0.1);
            } else {
                // ä¸æ­£è§£ã®éŸ³ï¼ˆä½ã‚ã®ãƒ–ãƒƒã¨ã„ã†éŸ³ï¼‰
                oscillator.type = 'square';
                oscillator.frequency.setValueAtTime(220, audioCtx.currentTime);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + 0.15);
            }
            
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.2);
        }

        currentWordIndex++;
        
        setTimeout(displayWord, 300);
    }

    function speak(text) {
        if (synth.speaking) {
            console.error('speechSynthesis.speaking');
            return;
        }
        if (text !== '') {
            const utterThis = new SpeechSynthesisUtterance(text);
            utterThis.lang = 'en-US';
            utterThis.pitch = 1;
            utterThis.rate = 1;
            synth.speak(utterThis);
        }
    }

    function updateProgress() {
        const remainingInDeck = deck.length - currentWordIndex;
        const remainingInReview = reviewPile.length;
        progressDisplay.textContent = `æ®‹ã‚Š: ${remainingInDeck}å˜èª | è¦å¾©ç¿’: ${remainingInReview}å˜èª`;
    }

    function showCompletionScreen() {
        mainContent.style.display = 'none';
        completionScreen.style.display = 'block';
    }

    startSession();

    </script>
</body>
</html>